<section class="ion-margin-top">

  <ng-template #tmplNode let-node="node">
    <div class="node-item" [attr.data-id]="node.id" [attr.id]="'node-' + node.id">
      <div class="node-title ion-justify-content-center ion-align-items-center" (click)="node.isExpanded=!node.isExpanded">
        {{ node.criteresPerformance && node.criteresPerformance.length ? (node.isExpanded ? '-' : '+') : '' }} &nbsp;
        <span class="node-info">
          <span class="item-number">{{node.numero}}</span>
          <span class="item-text">{{node.texte}}</span>
        </span>
        <span class="item-notes" *ngIf="node.criteresPerformance && node.criteresPerformance.length"></span>

        <section>
          <ion-button *ngIf="this.node.criteresPerformance" class="btn-dad" color="light" (click)="stopPropagation($event); openModalFormulaireElementCompetence(this.node)">Modifier</ion-button>
          <ion-button *ngIf="!this.node.criteresPerformance" class="btn-dad" color="light" (click)="stopPropagation($event); openModalFormulaireCriterePerformance(this.node)">Modifier</ion-button>

          <ion-button *ngIf="this.node.criteresPerformance" class="btn-dad trash-dad"  color="danger" (click)="stopPropagation($event); confirmSuppressionElementComp(this.node)"><ion-icon name="trash"></ion-icon> </ion-button>
          <ion-button *ngIf="!this.node.criteresPerformance" class="btn-dad trash-dad"  color="danger" (click)="stopPropagation($event); confirmSuppressionCriterePerfo(this.node)"><ion-icon name="trash"></ion-icon> </ion-button>

        </section>
 </div>

      <div *ngIf="node.isExpanded && node.criteresPerformance && node.criteresPerformance.length" class="node-children" cdkDropList [cdkDropListData]="node.criteresPerformance"
           [id]="node.id" [cdkDropListConnectedTo]="dropTargetIds" (cdkDropListDropped)="drop($event)"
           [cdkDropListSortingDisabled]="true">
        <div *ngFor="let critere of node.criteresPerformance" cdkDrag [cdkDragData]="critere.id" (cdkDragMoved)="dragMoved($event)">
          <ng-container *ngTemplateOutlet="tmplNode; context:{ node: critere }"></ng-container>
        </div>
      </div>
    </div>
  </ng-template>
</section>

<div cdkDropList [cdkDropListData]="nodes" [id]="'main'" [cdkDropListConnectedTo]="dropTargetIds" (cdkDropListDropped)="drop($event)" [cdkDropListSortingDisabled]="true">
  <div *ngFor="let element of nodes" cdkDrag [cdkDragData]="element.id" (cdkDragMoved)="dragMoved($event)">
    <ng-container *ngTemplateOutlet="tmplNode; context:{ node: element }"></ng-container>
  </div>
</div>
